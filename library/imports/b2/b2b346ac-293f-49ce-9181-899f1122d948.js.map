{"version":3,"sources":["assets\\Script\\Component\\BannerShow.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["var EChannel = cc.Enum({\r\n    'NONE': 0,\r\n    'wx': 1,\r\n});\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BannerShow extends cc.Component {\r\n\r\n    @property({ displayName: '渠道' })\r\n    channel: string = 'wx';\r\n    @property\r\n    adUnitIdBanner: string = null;\r\n    @property\r\n    updateTime: number = null;\r\n\r\n    private _instance: any = null;\r\n    private noBanner: boolean = false;\r\n    private _bannerAd: any = null; //banner缓存池\r\n    private _poolMax: number = 10;\r\n    private _pool: any[] = [];\r\n    onLoad() {\r\n        if (window[this.channel] && this.adUnitIdBanner) {\r\n            this.bannerCreator();\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        if (window[this.channel] && this.adUnitIdBanner) {\r\n            this.bannerShow();\r\n            this.bannerCreator();\r\n        }\r\n    }\r\n    onDisable() {\r\n        if (window[this.channel] && this.adUnitIdBanner) {\r\n            this.bannerHide();\r\n        }\r\n    }\r\n\r\n    bannerCreator() {\r\n        if (this._pool.length > this._poolMax) {\r\n            return;\r\n        }\r\n        let banner = window[this.channel].createBannerAd({ adUnitId: this.adUnitIdBanner, style: { left: 0, top: 0, width: 300, } });\r\n        banner.onError((res) => {\r\n            console.log('[banner] onError', res);\r\n            this.noBanner = true;\r\n        });\r\n        banner.onLoad(() => {\r\n            this._pool.unshift(banner);//添加到数组的第一个\r\n            if (this.node.active && !this._bannerAd) {\r\n                this.bannerShow();\r\n            }\r\n        });\r\n    }\r\n\r\n    bannerShow() {\r\n        this.bannerHide();\r\n        if (this._pool.length > 0) {\r\n            this._bannerAd = this._pool.shift();\r\n            this.setBannerStyle(this._bannerAd);\r\n            this._bannerAd.show();\r\n        }\r\n    }\r\n\r\n    bannerHide() {\r\n        if (this._bannerAd) {\r\n            this._bannerAd.hide();\r\n            this._pool.push(this._bannerAd);\r\n            this._bannerAd = null;\r\n        }\r\n    }\r\n\r\n    setBannerStyle = function (ad: any) {\r\n        var btnRect = this.node.getBoundingBoxToWorld();\r\n        var anchorX = this.node.anchorX;\r\n        var anchorY = this.node.anchorY;\r\n        let frameSize = cc.view.getFrameSize();// 屏幕尺寸\r\n        let winSize = cc.winSize;// 实际分辨率\r\n        let nodeX = btnRect.xMin + anchorX * btnRect.width;\r\n        let nodeY = btnRect.yMin + anchorY * btnRect.height;\r\n        let bannerHeight = ad.style.realHeight;\r\n        let bannerWidth = ad.style.realWidth;\r\n        let x = nodeX / winSize.width * frameSize.width;\r\n        let y = (winSize.height - nodeY) / winSize.height * frameSize.height;\r\n        let left = x - bannerWidth * anchorX;\r\n        let top = y - bannerHeight * (1 - anchorY);\r\n        ad.style.left = left;\r\n        ad.style.top = top;\r\n    };\r\n}"]}