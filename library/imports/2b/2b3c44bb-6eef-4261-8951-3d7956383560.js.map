{"version":3,"sources":["assets\\Script\\Modules\\GSdk.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["var config = {\r\n    ver: 'v1.0.1',\r\n    gameid: 'hcdxg', //合成大西瓜\r\n    adUnitId: 'adunit-0962db6f5f64227e',\r\n    adUnitIdBanner: 'adunit-c657987ad0dd2c34',\r\n    adUnitIdInterstitial: 'adunit-c83e928d371ea96f',\r\n    serverHost: 'https://minigame.ucpopo.com/matrix/',\r\n    shareData: {\r\n        title: \"有人@你 进来和我一起玩!\",\r\n        imageUrl: \"http://cos.ucpopo.com/zqcgc/share_xigua.jpg\"\r\n        //imageUrl: 'res/share.png',\r\n    },\r\n};\r\n\r\nexport class GSdk {\r\n    version = 'v1.0.1';\r\n    isInit = false;\r\n    user = {\r\n        openid: null, //用户的openid\r\n        sessid: null, //用户的sessid\r\n    };\r\n    init() {\r\n        if (window['wx'] && !this.isInit) {\r\n            console.log('GSdk init');\r\n            this.isInit = true;\r\n            // 初始化激励视频组件\r\n            this.video.init();\r\n            //this.banner.init();\r\n            this.interstitial.create();\r\n            this.onShareAppMessage();\r\n            window['wx'].setKeepScreenOn({ keepScreenOn: true });\r\n            this.updateNew();\r\n        }\r\n    }\r\n    updateNew() {\r\n        if (window['wx']) {\r\n            const updateManager = window['wx'].getUpdateManager();\r\n            updateManager.onUpdateReady(function () {\r\n                updateManager.applyUpdate();\r\n            });\r\n        }\r\n    };\r\n    //监听用户点击右上角菜单的「转发」按钮时触发的事件\r\n    onShareAppMessage() {\r\n        if (window['wx']) {\r\n            let query = 'shareid=' + this.user.openid;\r\n            window['wx'].showShareMenu({\r\n                withShareTicket: true\r\n            });\r\n            window['wx'].onShareAppMessage(() => ({\r\n                title: config.shareData.title,\r\n                imageUrl: config.shareData.imageUrl,\r\n                query: query,\r\n            }));\r\n        }\r\n    };\r\n    //主动拉起转发，进入选择通讯录界面。\r\n    shareAppMessage(params) {\r\n        if (window['wx']) {\r\n            if (!params) {\r\n                params = {};\r\n                params.title = config.shareData.title;\r\n                params.imageUrl = config.shareData.imageUrl;\r\n                params.query = 'shareid=' + this.user.openid;\r\n            }\r\n            window['wx'].shareAppMessage({\r\n                title: params.title,\r\n                imageUrl: params.imageUrl,\r\n                query: params.query,\r\n            });\r\n        }\r\n    };\r\n    video = {\r\n        isInit: false,\r\n        errCode: false,\r\n        isLoad: false, //从微信拉取信息，更新是否可看视频状态\r\n        _video: null,\r\n        cb: null, //播放回调\r\n        init() {\r\n            this.isInit = true;\r\n            this._video = window['wx'].createRewardedVideoAd({ adUnitId: config.adUnitId });\r\n            // 监听激励视频广告加载事件\r\n            this._video.onLoad(() => { this.isLoad = true; });\r\n            // 监听激励视频广告关闭事件\r\n            this._video.onClose(res => {\r\n                if (res && res.isEnded || res === undefined) {\r\n                    this.cb && this.cb(null, true);\r\n                } else {\r\n                    console.log('播放中途退出，不下发游戏奖励');\r\n                    this.cb && this.cb(true, null);\r\n                }\r\n                this.cb = null;\r\n            });\r\n            //监听激励视频错误事件\r\n            this._video.onError((res) => {\r\n                if (res.errCode >= 1004 && res.errCode <= 1008) {\r\n                    this.errCode = res.errCode;\r\n                }\r\n            });\r\n        },\r\n        show(cb) {\r\n            if (!window['wx']) {\r\n                cb && cb('不在微信环境下', null);\r\n                return;\r\n            }\r\n            if (!this.errCode) {\r\n                this._video.load()\r\n                    .then(() => {\r\n                        //this._hide();\r\n                        this.cb = cb;\r\n                        this._video.show();\r\n                    })\r\n                    .catch((res) => {\r\n                        //本次视频播放失败，更新可播放状态\r\n                        this._video.load();\r\n                        if (res.errCode) {\r\n                            cb && cb('暂无视频可看(' + res.errCode + ')', null);\r\n                        } else {\r\n                            cb && cb('点太快了', null);\r\n                        }\r\n                    });\r\n            } else {\r\n                cb && cb('暂无视频可看', null);\r\n            }\r\n        }\r\n    };\r\n    interstitial = {\r\n        closeCb: null, //关闭回调\r\n        item: null,\r\n        create() {\r\n            let item = window['wx'].createInterstitialAd({\r\n                adUnitId: config.adUnitIdInterstitial\r\n            });\r\n            item.onLoad(() => {\r\n                this.item = item;\r\n                this.item.onClose(() => {\r\n                    this.closeCb && this.closeCb();\r\n                    this.create();\r\n                });\r\n            });\r\n        },\r\n        show(cb?) {\r\n            this.closeCb = cb || null;\r\n            this.item && this.item.show();\r\n        }\r\n    };\r\n    storage = {\r\n        _cache: {},\r\n        set(key, value) {\r\n            if (typeof key === 'string' && typeof value !== 'undefined') {\r\n                try {\r\n                    let data = JSON.stringify(value);\r\n                    cc.sys.localStorage.setItem(key, data);\r\n                    // 设置缓存\r\n                    this._cache[key] = data;\r\n                    return true;\r\n                } catch (err) {\r\n\r\n                }\r\n            } else {\r\n                cc.error('error');\r\n            }\r\n            return false;\r\n        },\r\n        get(key) {\r\n            // 先读取缓存\r\n            if (typeof this._cache[key] !== 'undefined') {\r\n                return JSON.parse(this._cache[key]);\r\n            }\r\n            let result = null;\r\n            try {\r\n                let data = cc.sys.localStorage.getItem(key);\r\n                if (data && typeof data === 'string') {\r\n                    // 设置缓存\r\n                    this._cache[key] = data;\r\n                    result = JSON.parse(data);\r\n                } else if (data !== '' && data !== null) {\r\n                    result = undefined;\r\n                }\r\n            } catch (e) {\r\n                result = undefined;\r\n            }\r\n            return result;\r\n        },\r\n        clear() {\r\n            try {\r\n                cc.sys.localStorage.clear();\r\n                cc.js.clear(this._cache);\r\n                return true;\r\n            } catch (err) {\r\n                return false;\r\n            }\r\n        }\r\n    };\r\n}\r\n/**暴露全局提示 */\r\ndeclare global {\r\n    /**\r\n     * 视频广告模块\r\n     */\r\n    const GSdk: GSdk;\r\n}\r\nwindow['GSdk'] = new GSdk();"]}