{"version":3,"sources":["assets\\Script\\GameSc.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mCAA8B;AAExB,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAE5C,IAAK,SAEJ;AAFD,WAAK,SAAS;IACV,2CAAK,CAAA;IAAE,6CAAM,CAAA;IAAE,yCAAI,CAAA;AACvB,CAAC,EAFI,SAAS,KAAT,SAAS,QAEb;AAED;IAAoC,0BAAY;IAAhD;QAAA,qEAiOC;QA9NG,gBAAU,GAAa,IAAI,CAAC;QAE5B,gBAAU,GAAY,IAAI,CAAC;QAE3B,uBAAiB,GAAc,IAAI,CAAC;QAEpC,iBAAW,GAAgB,EAAE,CAAC;QAE9B,cAAQ,GAAY,IAAI,CAAC;QAEjB,iBAAW,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACvC,iBAAW,GAAY,IAAI,CAAC;QAC5B,sBAAgB,GAAW,CAAC,CAAC;QAC7B,gBAAU,GAAc,SAAS,CAAC,MAAM,CAAC;QACzC,aAAO,GAAG,KAAK,CAAC;QAEhB,YAAM,GAAW,CAAC,CAAC;QA0InB,gBAAU,GAAe;YAC7B,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;YACjC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC;SACpC,CAAC;;IAwDN,CAAC;IA7MG,sBAAW,yBAAK;aAAhB;YACI,OAAO,IAAI,CAAC,MAAM,CAAC;QACvB,CAAC;aAED,UAAiB,CAAS;YACtB,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YAChB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAC1C,CAAC;;;OALA;IAOD,uBAAM,GAAN;QACI,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/C,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;QAE1D,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAED,sBAAK,GAAL;QACI,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACpE,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QACjE,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACnE,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,cAAc;QACd,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,KAAK,CAAC;QAE7B,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,aAAa,CACjC,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC;aAClB,EAAE,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC;aACvB,EAAE,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,CACjC,CAAC,KAAK,EAAE,CAAC;IACd,CAAC;IACD,WAAW;IACH,2BAAU,GAAlB,UAAmB,CAAsB;QAAzC,iBA2BC;QA1BG,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,MAAM,EAAE;YACtC,OAAO;SACV;QACD,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACnB,OAAO;SACV;QACD,IAAI,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAC5B,IAAI,CAAC,YAAY,CAAC,gBAAM,CAAC,CAAC,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC;QAC5D,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;QAEhE,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE;YAC9B,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;SAChC;aAAM,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE;YACtC,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;SACjC;QAED,IAAI,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC;QACrB,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC;aACT,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,GAAA,EAAE,CAAC;aAC9B,IAAI,CAAC;YACF,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,IAAI,GAAG,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC;YAChE,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,cAAc,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;YAChE,KAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC,CAAC;aACD,KAAK,EAAE,CAAC;IACjB,CAAC;IAEO,4BAAW,GAAnB,UAAoB,CAAsB;QACtC,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,MAAM,EAAE;YACrC,IAAI,IAAI,CAAC,WAAW,EAAE;gBAClB,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;gBAChE,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,EAAE;oBAC1C,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC;iBAC5C;qBAAM,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,EAAE;oBAClD,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC;iBAC7C;gBACD,IAAI,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,CAAC;aAC1B;SACJ;IACL,CAAC;IACD,uBAAuB;IACf,8BAAa,GAArB;QAAA,iBAsBC;QArBG,eAAe;QACf,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;SAC9B;QACD,IAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;QAC1F,IAAM,IAAI,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,CAAC;QAC3D,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,YAAY,CAAC,gBAAM,CAAC,CAAC,SAAS,CAAC;QAC5D,IAAI,CAAC,eAAe,CAAC,gBAAM,CAAC,CAAC;QAC7B,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC;QACb,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,IAAI,GAAG,EAAE,CAAC,aAAa,CAAC,MAAM,CAAC;QAC/D,kBAAkB;QAClB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC;aACT,KAAK,CAAC,GAAG,CAAC;aACV,IAAI,CAAC;YACF,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACnC,CAAC,CAAC;aACD,EAAE,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;aACrB,IAAI,CAAC;YACF,KAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QAC5B,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;IACnB,CAAC;IAEM,4BAAW,GAAlB,UAAmB,MAAe,EAAE,KAAc;QAAlD,iBAqCC;QApCG,IAAI,KAAK,GAAG,MAAM,CAAC,YAAY,CAAC,gBAAM,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC;QACtD,IAAI,KAAK,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YAClC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAElC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,OAAO,GAAG,KAAK,CAAC;YACvD,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,UAAU,EAAE;iBAC9D,IAAI,CAAC;gBACF,IAAM,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,KAAI,CAAC,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;gBAC5D,OAAO,CAAC,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;gBACnC,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;gBAClC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;gBAC9B,IAAM,GAAG,GAAG,EAAE,CAAC,WAAW,CAAC,KAAI,CAAC,iBAAiB,CAAC,CAAC;gBACnD,GAAG,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC;gBAClB,GAAG,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC;gBAClB,GAAG,CAAC,KAAK,GAAG,KAAI,CAAC,UAAU,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;gBACvC,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;gBAC9B,IAAI,KAAK,IAAI,KAAI,CAAC,WAAW,CAAC,MAAM,IAAI,KAAI,CAAC,OAAO,IAAI,KAAK,EAAE;oBAC3D,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC;oBAEpB,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;iBACzC;YACL,CAAC,CAAC;iBACD,KAAK,EAAE,CAAC;YACb,IAAI,CAAC,KAAK,IAAI,MAAM,CAAC,YAAY,CAAC,gBAAM,CAAC,CAAC,SAAS,CAAC;YACpD,WAAW;YACX,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,UAAC,KAAK;gBACjC,OAAO,KAAK,IAAI,KAAK,GAAG,CAAC,CAAC;YAC9B,CAAC,CAAC,GAAG,CAAC,EAAE;gBACJ,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,CAAC,IAAO,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC3H,gCAAgC;gBAChC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;aACpC;YACD,OAAO,IAAI,CAAC;SACf;aAAM;YACH,OAAO,KAAK,CAAC;SAChB;IACL,CAAC;IAgBD,uBAAM,GAAN,UAAO,EAAE;QACL,IAAI,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,MAAM,EAAE;YACrC,IAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,uBAAuB,CAAC,gBAAM,CAAC,CAAC;YAC5D,IAAI,OAAO,GAAY,KAAK,CAAC;YAC7B,IAAI,IAAI,GAAY,KAAK,CAAC;YAC1B,KAAiB,UAAG,EAAH,WAAG,EAAH,iBAAG,EAAH,IAAG,EAAE;gBAAjB,IAAI,IAAI,YAAA;gBACT,IAAI,CAAC,IAAI,CAAC,cAAc;oBAAE,SAAS;gBACnC,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;oBACvD,OAAO,GAAG,IAAI,CAAC;iBAClB;gBACD,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE;oBAChC,IAAI,GAAG,IAAI,CAAC;oBACZ,MAAM;iBACT;aACJ;YACD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,OAAO,CAAC;YAC/B,IAAI,IAAI,EAAE;gBACN,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,IAAI,CAAC;gBACjC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;gBACzB,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;aAC1C;SACJ;IACL,CAAC;IAED,uBAAM,GAAN;QAAA,iBAwBC;QAvBG,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC;QACxC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC,KAAK,CAAC;QAClC,IAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,uBAAuB,CAAC,gBAAM,CAAC,CAAC;gCACnD,CAAC;YACN,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,IAAI,CACrC;gBACI,IAAM,GAAG,GAAG,EAAE,CAAC,WAAW,CAAC,KAAI,CAAC,iBAAiB,CAAC,CAAC;gBACnD,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACtB,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACtB,GAAG,CAAC,KAAK,GAAG,KAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;gBAClD,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAClC,CAAC,CACJ,CAAC,UAAU,EAAE,CAAC,KAAK,EAAE,CAAC;;QAT3B,KAAK,IAAI,CAAC,GAAG,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE;oBAA/B,CAAC;SAUT;QACD,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC;aACjC,IAAI,CAAC;YACF,KAAI,CAAC,UAAU,GAAG,SAAS,CAAC,MAAM,CAAC;YACnC,cAAc;YACd,KAAI,CAAC,WAAW,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAC5C,KAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;QACf,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;IACzB,CAAC;IAED,yBAAQ,GAAR;QACI,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC;QACvC,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;IAC7B,CAAC;IA7ND;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;8CACS;IAE5B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;8CACS;IAE3B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;qDACgB;IAEpC;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;+CACQ;IAE9B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;4CACO;IAXR,MAAM;QAD1B,OAAO;OACa,MAAM,CAiO1B;IAAD,aAAC;CAjOD,AAiOC,CAjOmC,EAAE,CAAC,SAAS,GAiO/C;kBAjOoB,MAAM","file":"","sourceRoot":"/","sourcesContent":["import BallSc from \"./BallSc\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nenum GameState {\r\n    start, gaming, over\r\n}\r\n@ccclass\r\nexport default class GameSc extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    scoreLabel: cc.Label = null;\r\n    @property(cc.Node)\r\n    ballsLayer: cc.Node = null;\r\n    @property(cc.Prefab)\r\n    waterEffectPrefab: cc.Prefab = null;\r\n    @property([cc.Prefab])\r\n    ballsPrefab: cc.Prefab[] = [];\r\n    @property(cc.Node)\r\n    deadLine: cc.Node = null;\r\n\r\n    private randomArray = [0, 0, 0, 0, 1, 1, 2, 3];\r\n    private currentBall: cc.Node = null;\r\n    private currentBallIndex: number = 0;\r\n    private _gameState: GameState = GameState.gaming;\r\n    private _winner = false;\r\n\r\n    private _score: number = 0;\r\n    public get score(): number {\r\n        return this._score;\r\n    }\r\n\r\n    public set score(v: number) {\r\n        this._score = v;\r\n        this.scoreLabel.string = v.toFixed(0);\r\n    }\r\n\r\n    onLoad() {\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        cc.director.getPhysicsManager().gravity = cc.v2(0, -1280);\r\n\r\n        GSdk.init();\r\n    }\r\n\r\n    start() {\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchMove, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.CreateNewBall();\r\n        //死亡线在球接近的时候闪烁\r\n        this.deadLine.active = false;\r\n\r\n        cc.tween(this.deadLine).repeatForever(\r\n            cc.tween(this.deadLine)\r\n                .to(0.3, { opacity: 0 })\r\n                .to(0.3, { opacity: 255 })\r\n        ).start();\r\n    }\r\n    /** 松开弹射 */\r\n    private onTouchEnd(e: cc.Event.EventTouch) {\r\n        if (this._gameState !== GameState.gaming) {\r\n            return;\r\n        }\r\n        if (!this.currentBall) {\r\n            return;\r\n        }\r\n        let ball = this.currentBall;\r\n        ball.addComponent(BallSc).BallIndex = this.currentBallIndex;\r\n        this.currentBall = null;\r\n        let x = this.ballsLayer.convertToNodeSpaceAR(e.getLocation()).x;\r\n\r\n        if (x > 720 / 2 - ball.width / 2) {\r\n            x = 720 / 2 - ball.width / 2;\r\n        } else if (x < -720 / 2 + ball.width / 2) {\r\n            x = -720 / 2 + ball.width / 2;\r\n        }\r\n\r\n        let speed = 1 / 1000;\r\n        cc.tween(ball)\r\n            .to(Math.abs(speed * x), { x })\r\n            .call(() => {\r\n                ball.getComponent(cc.RigidBody).type = cc.RigidBodyType.Dynamic;\r\n                ball.getComponent(cc.RigidBody).linearVelocity = cc.v2(0, -300);\r\n                this.CreateNewBall();\r\n            })\r\n            .start();\r\n    }\r\n\r\n    private onTouchMove(e: cc.Event.EventTouch) {\r\n        if (this._gameState == GameState.gaming) {\r\n            if (this.currentBall) {\r\n                let x = this.ballsLayer.convertToNodeSpaceAR(e.getLocation()).x;\r\n                if (x > 720 / 2 - this.currentBall.width / 2) {\r\n                    x = 720 / 2 - this.currentBall.width / 2;\r\n                } else if (x < -720 / 2 + this.currentBall.width / 2) {\r\n                    x = -720 / 2 + this.currentBall.width / 2;\r\n                }\r\n                this.currentBall.x = x;\r\n            }\r\n        }\r\n    }\r\n    /** 创建一个新的球在等待射击的位置上 */\r\n    private CreateNewBall() {\r\n        // 如果之前的球存在则销毁它\r\n        if (this.currentBall) {\r\n            this.currentBall.destroy();\r\n        }\r\n        const randomIndex = this.randomArray[Math.floor(Math.random() * this.randomArray.length)];\r\n        const ball = cc.instantiate(this.ballsPrefab[randomIndex]);\r\n        this.currentBallIndex = ball.getComponent(BallSc).BallIndex;\r\n        ball.removeComponent(BallSc);\r\n        ball.y = 566;\r\n        ball.getComponent(cc.RigidBody).type = cc.RigidBodyType.Static;\r\n        //this.currentBall\r\n        ball.scale = 0;\r\n        cc.tween(ball)\r\n            .delay(0.2)\r\n            .call(() => {\r\n                this.ballsLayer.addChild(ball);\r\n            })\r\n            .to(0.2, { scale: 1 })\r\n            .call(() => {\r\n                this.currentBall = ball;\r\n            }).start();\r\n    }\r\n\r\n    public BallLevelUp(target: cc.Node, other: cc.Node) {\r\n        let index = target.getComponent(BallSc).BallIndex + 1;\r\n        if (index <= this.ballsPrefab.length) {\r\n            cc.game.emit('game-ball-levelup');\r\n\r\n            other.getComponent(cc.PhysicsCollider).enabled = false;\r\n            cc.tween(other).to(0.15, { x: target.x, y: target.y }).removeSelf()\r\n                .call(() => {\r\n                    const newBall = cc.instantiate(this.ballsPrefab[index - 1]);\r\n                    newBall.position = target.position;\r\n                    this.ballsLayer.addChild(newBall);\r\n                    target.removeFromParent(true);\r\n                    const eff = cc.instantiate(this.waterEffectPrefab);\r\n                    eff.x = newBall.x;\r\n                    eff.y = newBall.y;\r\n                    eff.color = this.ballColors[index - 1];\r\n                    this.ballsLayer.addChild(eff);\r\n                    if (index == this.ballsPrefab.length && this._winner == false) {\r\n                        this._winner = true;\r\n\r\n                        cc.find('Canvas/WinUI').active = true;\r\n                    }\r\n                })\r\n                .start();\r\n            this.score += target.getComponent(BallSc).BallIndex;\r\n            // 对随机范围作扩充\r\n            if (this.randomArray.findIndex((value) => {\r\n                return value == index - 1;\r\n            }) < 0) {\r\n                this.randomArray = this.randomArray.concat(JSON.parse(JSON.stringify(this.randomArray))).sort((a, b) => { return a - b; });\r\n                //console.log(this.randomArray);\r\n                this.randomArray.push(index - 1);\r\n            }\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private ballColors: cc.Color[] = [\r\n        new cc.Color().fromHEX(\"#862274\"),\r\n        new cc.Color().fromHEX(\"#ff0925\"),\r\n        new cc.Color().fromHEX(\"#ff8e1c\"),\r\n        new cc.Color().fromHEX(\"#ffe614\"),\r\n        new cc.Color().fromHEX(\"#6de42e\"),\r\n        new cc.Color().fromHEX(\"#e61933\"),\r\n        new cc.Color().fromHEX(\"#fab36d\"),\r\n        new cc.Color().fromHEX(\"#ffe350\"),\r\n        new cc.Color().fromHEX(\"#fffaea\"),\r\n        new cc.Color().fromHEX(\"#fc7b97\"),\r\n        new cc.Color().fromHEX(\"#52d135\")\r\n    ];\r\n\r\n    update(dt) {\r\n        if (this._gameState == GameState.gaming) {\r\n            const arr = this.ballsLayer.getComponentsInChildren(BallSc);\r\n            let warning: boolean = false;\r\n            let over: boolean = false;\r\n            for (let ball of arr) {\r\n                if (!ball.isNotCheckOver) continue;\r\n                if (ball.node.y >= this.deadLine.y - ball.node.height / 2) {\r\n                    warning = true;\r\n                }\r\n                if (ball.node.y >= this.deadLine.y) {\r\n                    over = true;\r\n                    break;\r\n                }\r\n            }\r\n            this.deadLine.active = warning;\r\n            if (over) {\r\n                this._gameState = GameState.over;\r\n                console.log(\"Game Over\");\r\n                cc.find('Canvas/OverUI').active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    replay() {\r\n        cc.find('Canvas/OverUI').active = false;\r\n        this._gameState = GameState.start;\r\n        const arr = this.ballsLayer.getComponentsInChildren(BallSc);\r\n        for (let i = arr.length - 1; i >= 0; i--) {\r\n            cc.tween(arr[i].node).delay(0.1 * i).call(\r\n                () => {\r\n                    const eff = cc.instantiate(this.waterEffectPrefab);\r\n                    eff.x = arr[i].node.x;\r\n                    eff.y = arr[i].node.y;\r\n                    eff.color = this.ballColors[arr[i].BallIndex - 1];\r\n                    this.ballsLayer.addChild(eff);\r\n                }\r\n            ).removeSelf().start();\r\n        }\r\n        cc.tween(this).delay(arr.length * 0.1)\r\n            .call(() => {\r\n                this._gameState = GameState.gaming;\r\n                /** 恢复到原始状态 */\r\n                this.randomArray = [0, 0, 0, 0, 1, 1, 2, 3];\r\n                this.CreateNewBall();\r\n            }).start();\r\n        this.score = 0;\r\n        this._winner = false;\r\n    }\r\n\r\n    closeWin() {\r\n        cc.find('Canvas/WinUI').active = false;\r\n        GSdk.interstitial.show();\r\n    }\r\n}\r\n\r\n"]}